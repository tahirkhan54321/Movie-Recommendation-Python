{% extends 'base.html' %}

{% block title %}Movie Recommender{% endblock %}

{% block content %}

<main class="movie_search">
    <div class="container p-3"> 
        <div class="row justify-content-center"> 
            <div class="col-md-8"> 
                <div class="card p-3"> 
                    <div class="card-body">
                        <h2 class="card-title p-2">Recommend me a movie similar to</h2>
                        <form method="post" class="p-2">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <button type="submit" class="btn btn-primary">Submit</button>

                            {% if messages %}
                                <ul class="messages mt-3"> 
                                    {% for message in messages %}
                                        <li{% if message.tags %} class="alert alert-{{ message.tags }}"{% endif %}>{{ message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </form>

                        {% if final_recommendations %}
                            <h3 class="mt-4">10 Movies Similar to "{{ form.cleaned_data.title }}"</h3>
                            <ul class="list-group mt-3">
                                {% for movie in final_recommendations %}
                                    <li class="list-group-item">
                                        <a href="{% url 'movie_details' movie.pk %}">{{ movie.title }}</a>
                                        {% if user.is_authenticated %}
                                            {% if movie in watchlist %}
                                                <a href="{% url 'remove_from_watchlist' movie.movie_id %}" class="btn btn-sm btn-outline-danger float-end">Remove from Watchlist</a> 
                                            {% else %}
                                                <a href="{% url 'add_to_watchlist' movie.movie_id %}" class="btn btn-sm btn-outline-success float-end">Add to Watchlist</a>
                                            {% endif %}
                                        {% endif %}
                                    </li> 
                                {% endfor %}
                            </ul>
                        {% elif form.cleaned_data %} 
                            <p class="mt-3">No movies similar to "{{ form.cleaned_data.title }}" were found.</p>
                        {% endif %}
                    </div> 
                </div> 
            </div> 
        </div> 
    </div>
</main>

{% endblock %} 
